<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Fixed OBJ Viewer</title>
  <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/aframe-physics-system@4.0.1/dist/aframe-physics-system.min.js"></script>
  <style>
    body { margin: 0; overflow: hidden; }
    .controls, .lights, .sliders, .reset {
      position: absolute; z-index: 999;
    }
    .controls {
      bottom: 20px; left: 20px;
      display: grid; grid-template-columns: repeat(3, 50px); gap: 5px;
    }
    .lights {
      top: 20px; right: 20px;
      display: flex; flex-direction: column; gap: 10px;
    }
    .sliders {
      bottom: 20px; right: 20px;
      display: flex; flex-direction: column;
      gap: 5px; background: rgba(255, 255, 255, 0.8);
      padding: 10px; border-radius: 10px;
    }
    .reset { top: 20px; left: 20px; }
    button {
      background: #333; color: white;
      border: none; border-radius: 5px;
      padding: 10px; font-size: 16px; cursor: pointer;
    }
    input[type="range"] { width: 100px; }
  </style>
</head>
<body>

<!-- UI Buttons -->
<div class="reset"><button onclick="resetPosition()">Reset</button></div>
<div class="controls">
  <button onclick="move('forward-left')">↖</button>
  <button onclick="move('forward')">↑</button>
  <button onclick="move('forward-right')">↗</button>
  <button onclick="move('left')">←</button>
  <button onclick="jump()">⤒</button>
  <button onclick="move('right')">→</button>
  <button onclick="move('backward-left')">↙</button>
  <button onclick="move('backward')">↓</button>
  <button onclick="move('backward-right')">↘</button>
</div>
<div class="lights">
  <button onclick="toggleLight('ambient')">Ambient</button>
  <button onclick="toggleLight('directional')">Directional</button>
  <button onclick="toggleLight('point')">Point</button>
</div>
<div class="sliders">
  <label>Ambient</label><input type="range" min="0" max="2" step="0.1" value="1" oninput="setLight('ambient', this.value)">
  <label>Directional</label><input type="range" min="0" max="5" step="0.1" value="3" oninput="setLight('directional', this.value)">
  <label>Point</label><input type="range" min="0" max="5" step="0.1" value="3" oninput="setLight('point', this.value)">
</div>

<a-scene physics="gravity: -9.8" embedded>
  <a-assets>
    <a-asset-item id="my-obj" src="test.obj"></a-asset-item>
    <a-asset-item id="my-mtl" src="test.mtl"></a-asset-item>
  </a-assets>

  <!-- Lights -->
  <a-light id="ambientLight" type="ambient" intensity="1" color="#fff"></a-light>
  <a-light id="directionalLight" type="directional" intensity="3" color="#fff" position="2 4 3"></a-light>
  <a-light id="pointLight" type="point" intensity="3" color="#fff" distance="10" position="0 3 3"></a-light>

  <!-- Camera Rig -->
  <a-entity id="rig" position="0 1.6 3" dynamic-body="mass: 1; shape: box;">
    <a-camera look-controls="touchEnabled: true" wasd-controls-enabled="false"></a-camera>
  </a-entity>

  <!-- 3D Model -->
  <a-entity id="model" obj-model="obj: #my-obj; mtl: #my-mtl"
    position="0 0 -3" scale="3 3 3" shadow static-body>
  </a-entity>

  <!-- Ground Plane -->
  <a-plane rotation="-90 0 0" width="20" height="20" color="#8B4513"
    shadow static-body></a-plane>
</a-scene>

<!-- JavaScript -->
<script>
  let bodyLoaded = false;
  const rig = document.querySelector('#rig');
  rig.addEventListener('body-loaded', () => { bodyLoaded = true; });

  function move(dir) {
    const pos = rig.getAttribute('position');
    const step = 0.3;
    const dirs = {
      forward: [0, 0, -step], backward: [0, 0, step],
      left: [-step, 0, 0], right: [step, 0, 0],
      'forward-left': [-step, 0, -step],
      'forward-right': [step, 0, -step],
      'backward-left': [-step, 0, step],
      'backward-right': [step, 0, step]
    };
    const [dx, dy, dz] = dirs[dir];
    rig.setAttribute('position', {x: pos.x + dx, y: pos.y + dy, z: pos.z + dz});
  }

  function jump() {
    if (bodyLoaded && rig.body.velocity.y < 0.1) {
      rig.body.applyImpulse({x: 0, y: 5, z: 0}, rig.body.position);
    }
  }

  function resetPosition() {
    rig.setAttribute('position', {x: 0, y: 1.6, z: 3});
    if (bodyLoaded) rig.body.velocity.set(0, 0, 0);
  }

  function toggleLight(type) {
    const light = document.getElementById(type + 'Light');
    light.setAttribute('visible', !light.getAttribute('visible'));
  }

  function setLight(type, val) {
    const light = document.getElementById(type + 'Light');
    light.setAttribute('intensity', parseFloat(val));
  }
</script>

</body>
</html>


