<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Camera Collision Scene</title>
    <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
    <script src="https://unpkg.com/aframe-event-set-component@^4.0.0/dist/aframe-event-set-component.min.js"></script>
    <script src="https://unpkg.com/super-hands@2.1.0/dist/super-hands.min.js"></script>
    <script src="https://cdn.rawgit.com/donmccurdy/aframe-extras/v3.13.1/dist/aframe-extras.min.js"></script>
    <style>
      body {
        margin: 0;
        overflow: hidden;
      }
    </style>
  </head>
  <body>
    <a-scene physics="gravity: -9.8" embedded cursor="rayOrigin: mouse">
      
      <!-- CAMERA COLLIDER -->
      <a-entity id="cameraCollider"
                geometry="primitive: sphere; radius: 0.3"
                position="0 1.6 0"
                dynamic-body
                visible="false">
      </a-entity>

      <!-- CAMERA RIG (Follows collider manually) -->
      <a-entity id="cameraRig">
        <a-camera look-controls></a-camera>
      </a-entity>

      <!-- GROUND -->
      <a-plane position="0 0 -4"
               rotation="-90 0 0"
               width="30"
               height="30"
               color="#7BC8A4"
               static-body>
      </a-plane>

      <!-- OBJECTS -->
      <a-box id="box"
             position="0 0.5 -3"
             color="#4CC3D9"
             static-body
             class="clickable">
      </a-box>

      <a-sphere id="sphere"
                position="2 1.25 -5"
                radius="1.25"
                color="#EF2D5E"
                static-body
                class="clickable">
      </a-sphere>

      <!-- SKY -->
      <a-sky color="#ECECEC"></a-sky>
    </a-scene>

    <script>
      const cameraCollider = document.querySelector('#cameraCollider');
      const cameraRig = document.querySelector('#cameraRig');
      const clickableEls = document.querySelectorAll('.clickable');

      function moveCameraTo(pos) {
        cameraCollider.setAttribute('position', pos);
        setTimeout(() => {
          // Update camera position once after collider moves
          const updatedPos = cameraCollider.object3D.position;
          cameraRig.setAttribute('position', {
            x: updatedPos.x,
            y: updatedPos.y,
            z: updatedPos.z
          });
        }, 100);
      }

      clickableEls.forEach(el => {
        el.addEventListener('click', () => {
          const target = el.object3D.position;
          // Move near the object instead of inside
          const dir = new THREE.Vector3().copy(target).normalize().multiplyScalar(1.5);
          const newPos = {
            x: target.x - dir.x,
            y: target.y + 1,
            z: target.z - dir.z
          };
          moveCameraTo(newPos);

          if (el.id === 'sphere') {
            alert('Confirmed: Sphere clicked');
          }
        });
      });
    </script>
  </body>
</html>

